#LyX 2.0 created this file. For more info see http://www.lyx.org/
\lyxformat 413
\begin_document
\begin_header
\textclass biometrics
\begin_preamble

\usepackage{setspace}\usepackage{bm}\usepackage{Sweave}

%\documentclass[useAMS,usenatbib,referee]{biom}

%\usepackage[latin9]{inputenc}
%\usepackage{geometry}
%\geometry{verbose}

%\usepackage{amssymb}
%\usepackage{esint}
%\usepackage{Sweave}
%\usepackage{amsthm}\usepackage{epsfig}\usepackage{psfrag}

\setcounter{footnote}{2}
\end_preamble
\options referee,useAMS,usenatbib
\use_default_options false
\begin_modules
sweave
\end_modules
\maintain_unincluded_children false
\language english
\language_package none
\inputencoding auto
\fontencoding default
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\use_non_tex_fonts false
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100

\graphics default
\default_output_format default
\output_sync 0
\bibtex_command default
\index_command default
\paperfontsize 12
\spacing single
\use_hyperref false
\papersize default
\use_geometry false
\use_amsmath 1
\use_esint 1
\use_mhchem 0
\use_mathdots 0
\cite_engine natbib_authoryear
\use_bibtopic false
\use_indices false
\paperorientation portrait
\suppress_date false
\use_refstyle 0
\index Index
\shortcut idx
\color #008000
\end_index
\secnumdepth 3
\tocdepth 3
\paragraph_separation indent
\paragraph_indentation default
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\html_math_output 0
\html_css_as_file 0
\html_be_strict false
\end_header

\begin_body

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "firstpage"

\end_inset


\begin_inset Note Note
status open

\begin_layout Plain Layout
This file was used to generate randomscalepaper.rnw - but further changes
 were only made in the .rnw file
\end_layout

\end_inset


\end_layout

\begin_layout Title

\series bold
Distance Sampling with a Random Scale Detection Function
\end_layout

\begin_layout Author

\series bold
Cornelia S.
\begin_inset space \space{}
\end_inset

Oedekoven
\series default

\begin_inset Formula $^{\mathbf{1,*}}$
\end_inset

, 
\series bold
Jeff Laake
\series default

\begin_inset Formula $^{\mathbf{2}}$
\end_inset

 and 
\series bold
Hans J.
\begin_inset space \space{}
\end_inset

Skaug
\series default

\begin_inset Formula $^{\mathbf{3}}$
\end_inset


\begin_inset Newline newline
\end_inset

 
\begin_inset Formula $^{(1)}$
\end_inset

School of Mathematics and Statistics, University of St 
\begin_inset Newline newline
\end_inset

 Andrews, St Andrews, KY16 9LZ, UK
\begin_inset Newline newline
\end_inset

 
\begin_inset Formula $^{(2)}$
\end_inset

Alaska Fisheries Science Center, NOAA, Seattle, WA, USA 98115
\begin_inset Newline newline
\end_inset

 
\begin_inset Formula $^{(3)}$
\end_inset

Faculty of Mathematics and Natural Sciences, 
\begin_inset Newline newline
\end_inset

 University of Bergen, Norway
\begin_inset Newline newline
\end_inset

 
\shape italic
*email:
\shape default
 cornelia@mcs.st-and.ac.uk
\end_layout

\begin_layout Standard
Full contact details for Cornelia Oedekoven: 
\end_layout

\begin_layout Standard
Centre for Research into Ecological and Environmental Modelling 
\end_layout

\begin_layout Standard
The Observatory
\end_layout

\begin_layout Standard
Buchanan Gardens 
\end_layout

\begin_layout Standard
University of St Andrews 
\end_layout

\begin_layout Standard
St Andrews, Fife 
\end_layout

\begin_layout Standard
KY16 9LZ Scotland, UK
\end_layout

\begin_layout Standard
+44 (0) 1334 461826
\end_layout

\begin_layout Standard
\begin_inset Newpage pagebreak
\end_inset


\end_layout

\begin_layout Abstract
\noindent
Distance sampling was developed to estimate wildlife abundance from observationa
l surveys with detection probabilities in the search area of less than one.
 We present novel analysis methods for estimating this detection probability
 that make use of random effects models to allow for unmodeled heterogeneity
 in detection.
 The scale parameter of the half-normal detection function is modeled with
 an intercept and a normal error term for each detection with mean zero
 and unknown standard deviation.
 In contrast to conventional distance sampling methods, our approach can
 deal with long-tailed detection functions without truncation.
 Compared to a fixed effect covariate approach, we think of the random effect
 as a covariate with unknown values and integrate over the random effect.
 We expand the random scale to a mixed scale model by adding fixed effect
 covariates.
 We analyse simulated data where subsets of the data originated from normal
 models with different intercepts.
 Here, the random scale and mixed scale models produce similar overall abundance
 estimates.
 However, when stratified abundance estimates are desired, the mixed model
 approach produces estimates that are closer to the truth than the random
 scale approach.
 We illustrate the mixed effect modelling approach with harbor porpoise
 vessel survey data and propose that a random or mixed effect model of the
 detection function scale be adopted as a standard approach for fitting
 detection functions in distance sampling.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
begin{keywords}
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\noindent
abundance estimation, heterogeneity in detection probabilities, half-normal,
 mixed effects
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
end{keywords}
\end_layout

\end_inset


\end_layout

\begin_layout Section
Introduction
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

library(RandomScale)
\end_layout

\begin_layout Plain Layout

library(R2admb)
\end_layout

\begin_layout Plain Layout

setEPS()
\end_layout

\begin_layout Plain Layout

Sys.setenv(PATH = paste("c:/admb/bin;c:admb/utilities;c:/MinGW/bin;", 
\end_layout

\begin_layout Plain Layout

            Sys.getenv("PATH"), sep = ";"))
\end_layout

\begin_layout Plain Layout

Sys.setenv(ADMB_HOME = "c:/admb")
\end_layout

\begin_layout Plain Layout

set.seed(123)
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\begin_inset Newline newline
\end_inset


\end_layout

\begin_layout Standard
\noindent
Distance sampling was developed to estimate wildlife abundance from observationa
l surveys with visibility bias 
\begin_inset CommandInset citation
LatexCommand citep
key "Buckland2001"

\end_inset

.
 This visibility bias may occur in the case that the observer misses objects
 within the search area resulting in average detection probabilities that
 are less than one.
 In this paper we present novel analysis methods for estimating this detection
 probability that make use of random effects models.
\end_layout

\begin_layout Standard
The two most common distance sampling methods are line and point transect
 sampling.
 For line transects, the observer travels down the line and records all
 perpendicular distances from the line to the detections of the species
 of interest.
 For point transects, the observer remains at the point for a fixed amount
 of time and records all radial distances from the point to the detections
 of the species of interest.
 For brevity, we will speak of objects below where each object may consist
 of single animals (or plants) or clusters of these.
 Here, we assume that all objects on the line or point are detected with
 certainty.
\end_layout

\begin_layout Standard
Using conventional distance sampling (CDS) methods, the first step of analysing
 distance sampling data generally consists of fitting a probability density
 function (pdf) 
\begin_inset Formula $f(x)$
\end_inset

 to the sample of observed distances to infer the detection probability
 for the sample 
\begin_inset CommandInset citation
LatexCommand citep
key "Buckland2001"

\end_inset

.
 This function depends on two functions, 
\begin_inset Formula $g(x)$
\end_inset

 and 
\begin_inset Formula $h(x)$
\end_inset

, where 
\begin_inset Formula $g(x)$
\end_inset

 is the probability of seeing an object at distance 
\shape italic
x
\shape default
 given the object is at that distance and 
\begin_inset Formula $h(x)$
\end_inset

 is the probability that the object is at distance 
\shape italic
x
\shape default
.
 The pdf 
\begin_inset Formula $f(x)$
\end_inset

 is given by:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
f(x)=\frac{g(x)h(x)}{\int g(u)h(u)du}\quad,
\]

\end_inset


\end_layout

\begin_layout Standard
\noindent
which is the probability density for seeing an object at 
\shape italic
x
\shape default
 conditional on that it was seen somewhere.
 From the assumption of random line or point placement 
\begin_inset CommandInset citation
LatexCommand citep
key "Buckland2001"

\end_inset

, we assume uniform density locally with respect to 
\shape italic
x
\shape default
 over a sample of lines or points.
 For lines, this means that 
\begin_inset Formula $h(x)=1/w$
\end_inset

 where 
\shape italic
w
\shape default
 is the strip half-width and for points 
\begin_inset Formula $h(x)=2\pi x/(\pi w^{2})$
\end_inset

 where 
\shape italic
w
\shape default
 is the radius of the circle.
 From here on, we will refer to line transect sampling although the methods
 we describe are the same for points with the adjustment for a different
 
\begin_inset Formula $h(x)$
\end_inset

.
 With 
\begin_inset Formula $h(x)=1/w$
\end_inset

, 
\begin_inset Formula $f(x)$
\end_inset

 simplifies to
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f(x)=\frac{g(x)}{\int_{0}^{w}g(u)du}\quad.\label{eq:lt pdf}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
With the additional assumption that detection at 
\shape italic
x
\shape default
=0 is perfect (i.e.
\begin_inset space \space{}
\end_inset


\begin_inset Formula $g(0)$
\end_inset

=1), 
\begin_inset Formula $f(x)$
\end_inset

 evaluated at distance zero is given by:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
f(0)=\frac{1}{\int_{0}^{w}g(u)du}\quad.\label{eq:lt pdf-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
For 
\shape italic
n
\shape default
 observations from strips of total length 
\shape italic
L
\shape default
 and width 2
\shape italic
w
\shape default
, object density within the total search area is:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
D=\frac{n}{2wLp}=\frac{n}{2wL\int_{0}^{w}g(u)\frac{1}{w}du}=\frac{nf(0)}{2L}\quad,\label{eq:density}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
where 
\begin_inset Formula $p=\int_{0}^{w}g(u)\frac{1}{w}du$
\end_inset

 is the average detection probability.
 Note that 
\shape italic
n
\shape default
 refers to the number of detected objects.
 In the case that objects consist of clusters of size larger than one, eq
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:density"

\end_inset

 needs to be multiplied with the expected cluster size to estimate density
 of individuals.
 Using the design-based approach from 
\begin_inset CommandInset citation
LatexCommand citep
key "Buckland2001"

\end_inset

, object abundance in the study area may be obtained by multiplying 
\shape italic
D
\shape default
 from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:density"

\end_inset

 with the size of the study area.
 The quantity 
\begin_inset Formula $\mu=\int_{0}^{w}g(u)du=wp$
\end_inset

 is called the effective strip width (ESW), but is actually a half-strip
 width for each side of the line.
 
\end_layout

\begin_layout Standard
However, when not considering cluster size, 
\shape italic
p
\shape default
 is the only quantity from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:density"

\end_inset

 that requires estimation, while 
\shape italic
n
\shape default
, 
\shape italic
w
\shape default
 and 
\shape italic
L
\shape default
 are known.
 Hence, it is important to fit a flexible detection function that allows
 unbiased estimation of 
\shape italic
p
\shape default
.
 Using CDS methods, this was generally accomplished by comparing the fits
 of multiple key-adjustment term combinations (see section 
\begin_inset CommandInset ref
LatexCommand ref
reference "s:exist"

\end_inset

 for details).
 However, recently two main new methods have been developed that allow modeling
 heterogeneity in detection probabilities by including observable covariates
 in the detection function model 
\begin_inset CommandInset citation
LatexCommand citep
key "Marques2003"

\end_inset

 or by using mixture models (
\begin_inset CommandInset citation
LatexCommand citealp
key "Miller"

\end_inset

, in prep).
\end_layout

\begin_layout Standard
In the following we begin by summarising these existing methods for fitting
 detection functions including their strengths and weaknesses (section 
\begin_inset CommandInset ref
LatexCommand ref
reference "s:exist"

\end_inset

).
 This sets the stage for section 
\begin_inset CommandInset ref
LatexCommand ref
reference "ss:random1"

\end_inset

 where we propose a new method, i.e.
\begin_inset space \space{}
\end_inset

the random scale detection function.
 We discuss three different formulations of the likelihood for this function
 of which two should produce unbiased estimates of abundance, while the
 third only delivers unbiased estimates under certain conditions (section
 
\begin_inset CommandInset ref
LatexCommand ref
reference "s:likelihoods"

\end_inset

).
 We expand the random scale to a mixed scale model (section 
\begin_inset CommandInset ref
LatexCommand ref
reference "s:mixed"

\end_inset

), demonstrate our proposed methods in a simulation study (section 
\begin_inset CommandInset ref
LatexCommand ref
reference "s:modelfitcode"

\end_inset

) and apply the mixed effect approach to harbor porpoise detections in compariso
n to the equivalent fixed effect approach (section 
\begin_inset CommandInset ref
LatexCommand ref
reference "sec:Application-to-harbor"

\end_inset

).
\end_layout

\begin_layout Section
Existing methods for fitting flexible detection functions
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "s:exist"

\end_inset

 Currently there are three primary ways to fit detection functions for distance
 sampling data.
 The most common is the key function and adjustment series described in
 
\begin_inset CommandInset citation
LatexCommand citet
key "Buckland2001"

\end_inset

.
 The general formula is:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
g(x)=\frac{k(x)(1+\sum_{j=1}^{m}a_{j}p_{j}(x))}{k(0)(1+\sum_{j=1}^{m}a_{j}p_{j}(0))}
\]

\end_inset


\end_layout

\begin_layout Standard
\noindent
where 
\begin_inset Formula $k(x)$
\end_inset

 is a key function, 
\begin_inset Formula $p_{j}(x)$
\end_inset

 is a series of adjustment functions with coefficients 
\begin_inset Formula $a_{j}$
\end_inset

 and 
\shape italic
m
\shape default
 the total number of adjustment terms fitted.
 The denominator scales the function such that 
\begin_inset Formula $g(0)$
\end_inset

=1 although it is not necessary for fitting because the denominator cancels
 in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lt pdf"

\end_inset

.
 An example is a half-normal key function and a cosine adjustment series
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
g(x)=\frac{\exp(-(x/\gamma)^{2}/2)(1+\sum_{j=1}^{m}a_{j}\cos(j\pi x/w))}{(1+\sum_{j=1}^{m}a_{j})}
\]

\end_inset


\end_layout

\begin_layout Standard
\noindent
where 
\begin_inset Formula $\gamma$
\end_inset

 is the scale parameter of the half-normal key function.
 This key-adjustment approach allows for flexible fitting to the observed
 distances.
 It does, however, require defining a truncation width (
\shape italic
w
\shape default
), imposing non-linear constraints to maintain monotonicity (i.e.
\begin_inset space \space{}
\end_inset


\begin_inset Formula $g(x_{1})\geq g(x_{2})$
\end_inset

 for all 
\begin_inset Formula $w\geq x_{2}>x_{1}$
\end_inset

) and ensuring that 
\begin_inset Formula $1\geq g(x)>0$
\end_inset

.
 In addition, it has been shown that fitting of detection functions with
 long tails is problematic with this approach.
\end_layout

\begin_layout Standard
A second approach is to include explanatory covariates (
\series bold
\shape italic
z
\series default
\shape default
) in the scale parameter of the half-normal or hazard-rate detection function
 
\begin_inset CommandInset citation
LatexCommand citep
key "Marques2003"

\end_inset

.
 An example using a half-normal detection function is:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
g(\bm{x}|\bm{z})=\exp(-[\bm{x}/\exp(\bm{X_{z}\bm{\beta}})]^{2}/2)\label{eq:mcds}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
where 
\series bold
\shape italic
x
\series default
\shape default
 is the vector of distances, 
\series bold
\shape italic
z
\series default
\shape default
 is a data vector or matrix (depending on how many covariates are included
 in the model), 
\begin_inset Formula $\bm{X_{z}}$
\end_inset

 is a design matrix for the covariates and 
\begin_inset Formula $\bm{\beta}$
\end_inset

 is a parameter vector.
 In comparison to the previous approach, no adjustment series need be used
 and the single parameter scale of the half-normal function (or the hazard-rate)
 is replaced with 
\shape italic

\begin_inset Formula $\exp(\bm{X_{z}\bm{\beta}})$
\end_inset


\shape default
.
 Hence, the scale of the detection function is adjusted for each detected
 object depending on the observed covariate values during the detection.
 Larger scales generally relate to higher detection probabilities at distances
 
\begin_inset Formula $x>0$
\end_inset

 compared to smaller scales.
\end_layout

\begin_layout Standard
The model in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mcds"

\end_inset

 is conditional on 
\series bold
\shape italic
z
\series default
\shape default
; hence, it is essential that the unspecified distribution for 
\series bold
\shape italic
z
\series default
\shape default
 is independent of 
\series bold
\shape italic
x
\series default
\shape default
.
 An obvious example where this fails is animal behavior that might differ
 with 
\series bold
\shape italic
x
\series default
\shape default
 (e.g.
\begin_inset space \space{}
\end_inset

responsive movement of the animals to the observer).
 This approach provides monotone detection functions without constraints,
 does not require truncation and is suitable for fitting long tails.
 It has the added advantage of providing better small-area estimates of
 density when the covariates vary spatially 
\begin_inset CommandInset citation
LatexCommand citep
key "Hedley2004"

\end_inset

.
 On the other hand, the covariate approach does depend on being able to
 identify and measure covariates that affect detection probability 
\begin_inset CommandInset citation
LatexCommand citep
key "Marques2003, Marques2007"

\end_inset

.
\end_layout

\begin_layout Standard
If there is any remaining lack of fit, the first and second approaches can
 be combined using covariates in the key function and a series adjustment
 
\begin_inset CommandInset citation
LatexCommand citep
before "e.g."
key "Marques2007"

\end_inset

.
 However, it is then fraught with the same problems as the first approach
 where the constraints may become even more problematic as they depend on
 the explanatory covariate values.
 Even if the function is constrained correctly for all observed values of
 
\series bold
\shape italic
z
\series default
\shape default
, predictions for unobserved values of 
\series bold
\shape italic
z
\series default
\shape default
 may yield invalid probabilities due to the addition of adjustment functions.
\end_layout

\begin_layout Standard
The third approach is rather recent and involves fitting a mixture of 
\shape italic
m
\shape default
 detection functions (
\begin_inset CommandInset citation
LatexCommand citealp
key "Miller"

\end_inset

, in prep) along the lines of 
\begin_inset CommandInset citation
LatexCommand citet
key "Pledger2000"

\end_inset

 for capture-recapture models.
 Here, the detection function can be represented as:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
g(x)=\sum_{j=1}^{m}\pi_{j}g_{j}'(x)
\]

\end_inset


\end_layout

\begin_layout Standard
\noindent
where 
\begin_inset Formula $\sum_{j=1}^{m}\pi_{j}=1$
\end_inset

 and 
\begin_inset Formula $g_{j}'(x)$
\end_inset

 is a properly specified detection function.
 As long as each component detection function is monotone, 
\begin_inset Formula $g(x)$
\end_inset

 will be monotone.
\end_layout

\begin_layout Section
Random and mixed scale detection functions
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "s:random"

\end_inset

 
\end_layout

\begin_layout Subsection
Random scale detection function
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "ss:random1"

\end_inset

 An additional approach we present here is to use random effects in the
 detection function scale to allow for unmodeled heterogeneity in detection.
 Consider a half-normal detection function where the scale parameter is
 modeled with an intercept 
\begin_inset Formula $\beta$
\end_inset

 and a normal error term 
\begin_inset Formula $\epsilon$
\end_inset

 for each detection with mean zero and unknown standard deviation (
\shape italic

\begin_inset Formula $\epsilon\sim N\left(0,\sigma_{\epsilon}\right)$
\end_inset


\shape default
):
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
g(x|\epsilon)=\exp(-x^{2}/(2\gamma(\epsilon)^{2}))\quad.\label{eq:ran gx}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
The scale is now modeled as:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
\gamma(\epsilon)=\exp(\beta+\epsilon)\quad.
\]

\end_inset


\end_layout

\begin_layout Standard
\noindent
We assume a normal distribution for 
\begin_inset Formula $\epsilon$
\end_inset

 and use 
\begin_inset Formula $N(\epsilon,0,\sigma_{\epsilon})=\exp\left(-0.5\left(\frac{\epsilon}{\sigma_{\epsilon}}\right)^{2}\right)\left(\sqrt{2\pi}\sigma_{\epsilon}\right)^{-1}$
\end_inset

 as shorthand for the normal density function evaluated at 
\begin_inset Formula $\epsilon$
\end_inset

 with mean zero and standard deviation 
\begin_inset Formula $\sigma_{\epsilon}$
\end_inset

.
 Considering that long-tails may result from some objects with high detection
 probabilities out to great distances or some conditions under which objects
 are detectable at great distances, it is clear that this random scale will
 be able to cope with long-tailed detection functions (i.e.
\begin_inset space \space{}
\end_inset

with large values for 
\begin_inset Formula $\epsilon$
\end_inset

).
\end_layout

\begin_layout Subsection
Likelihood formulations for the random scale detection function
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "s:likelihoods"

\end_inset


\end_layout

\begin_layout Standard
Using the random scale detection function, the marginalized likelihood for
 the sample of 
\shape italic
n
\shape default
 observed distances can be derived directly from equations 2.39 and 2.40 in
 
\begin_inset CommandInset citation
LatexCommand citet
key "Borchers2004"

\end_inset

.
 In comparison with the covariate approach using fixed effects from above,
 we think of the random effect as a covariate with unknown values and integrate
 over the random effect.
 This is accomplished by including an integral over the unknown random effect
 in both the numerator and denominator:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
L_{g}(\beta,\sigma_{\epsilon})=\prod_{i=1}^{n}\frac{\intop_{-\infty}^{\infty}g(x_{i}|\epsilon)\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon}{\intop_{-\infty}^{\infty}\int_{0}^{w}g(u|\epsilon)du\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon}\label{eq:g likelihood}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
where the 
\begin_inset Formula $x_{i}$
\end_inset

 refer to the distances to the detected objects with 
\shape italic

\begin_inset Formula $i=1,2,...,n$
\end_inset


\shape default
.
 We denote 
\shape italic

\begin_inset Formula $L_{g}$
\end_inset


\shape default
 with subscript 
\shape italic
g
\shape default
 indicating that here we use a properly defined detection function 
\shape italic

\begin_inset Formula $g(x|\epsilon)$
\end_inset


\shape default
 with 
\shape italic

\begin_inset Formula $g(0)=1$
\end_inset


\shape default
 (for comparison see 
\shape italic

\begin_inset Formula $L_{f}$
\end_inset


\shape default
 below).
 Also, in this formulation the scale intercept is denoted with 
\shape italic

\begin_inset Formula $\beta_{g}$
\end_inset


\shape default
.
 The numerator of eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 is the marginal probability that the 
\shape italic
i
\shape default
th object was seen at 
\shape italic

\begin_inset Formula $x_{i}$
\end_inset


\shape default
:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\intop_{-\infty}^{\infty}g(x_{i}|\epsilon)N(\epsilon,0,\sigma_{\epsilon})\frac{1}{w}d\epsilon\quad,\label{eq:num random}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
while the denominator of eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 is the marginal probability that the object was seen within truncation
 width 
\shape italic
w
\shape default
:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\intop_{-\infty}^{\infty}\int_{0}^{w}g(u|\epsilon)du\, N(\epsilon,0,\sigma_{\epsilon})\frac{1}{w}d\epsilon\quad.\label{eq:p random}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
We note that in contrast to point transects, the availability function for
 line transects 
\begin_inset Formula $h(x)=1/w$
\end_inset

 from eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:num random"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:p random"

\end_inset

 cancel in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

.
\end_layout

\begin_layout Standard
An alternative likelihood is:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
L_{f}(\beta,\sigma_{\epsilon})=\prod_{i=1}^{n}\frac{\intop_{-\infty}^{\infty}f(x_{i}|\epsilon)\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon}{\intop_{-\infty}^{\infty}\int_{0}^{w}f(u|\epsilon)du\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon}\label{eq:f likelihood}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
where
\end_layout

\begin_layout Standard
\noindent
\begin_inset Formula 
\[
f(x|\epsilon)=2\left(\sqrt{2\pi}\gamma(\epsilon)\right)^{-1}\exp\left(-x^{2}/(2\gamma(\epsilon)^{2})\right),\quad\quad x\geq0
\]

\end_inset

is the pdf in absence of truncation (
\begin_inset Formula $w=\infty).$
\end_inset


\end_layout

\begin_layout Standard
We now emphasize why and how 
\begin_inset Formula $L_{g}$
\end_inset

 and 
\begin_inset Formula $L_{f}$
\end_inset

 differ.
 It is tempting to think that they are based on the same model because the
 half-normal shapes of 
\begin_inset Formula $g(x|\epsilon)$
\end_inset

 and 
\begin_inset Formula $f(x|\epsilon)$
\end_inset

 formally satisfy the standard relationship eq 1.
 However, eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lt pdf"

\end_inset

 applies only to the marginal 
\begin_inset Formula $g$
\end_inset

 and 
\begin_inset Formula $f$
\end_inset

, and not to the individual level quantities 
\begin_inset Formula $g(x|\epsilon)$
\end_inset

 and 
\begin_inset Formula $f(x|\epsilon)$
\end_inset

 for each object.
 In fact, as 
\begin_inset Formula $g(x|\epsilon)=\left(\sqrt{\pi/2}\gamma(\epsilon)\right)f(x|\epsilon)$
\end_inset

, we have 
\begin_inset Formula 
\[
L_{g}(\beta,\sigma_{\epsilon})=\prod_{i=1}^{n}\frac{\intop_{-\infty}^{\infty}\gamma(\epsilon)f(x_{i}|\epsilon)\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon}{\intop_{-\infty}^{\infty}\int_{0}^{w}\gamma(\epsilon)f(u|\epsilon)du\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon},
\]

\end_inset

which makes it explicit that the marginalization 
\begin_inset Quotes eld
\end_inset

over the half-normal shape
\begin_inset Quotes erd
\end_inset

, may it be 
\begin_inset Formula $g$
\end_inset

 or 
\begin_inset Formula $f$
\end_inset

, is done differently in the two respective likelihoods 
\begin_inset Formula $L_{g}$
\end_inset

 and 
\begin_inset Formula $L_{f}$
\end_inset

.
 The reason for the difference is that the value of 
\begin_inset Formula $\epsilon$
\end_inset

 affects the detection probability of an individual object, as for any object
 at distances larger than zero, increasing 
\begin_inset Formula $\epsilon$
\end_inset

 increases the probability of detection 
\begin_inset Formula $g(x|\epsilon)$
\end_inset

.
 This, in turn, creates a selection bias at any given distance larger than
 zero towards those objects with the higher values for 
\begin_inset Formula $\epsilon$
\end_inset

.
 The following paragraph, which is proved in the appendix, shows that this
 is indeed true and that it is possible to quantify this selection bias.
\end_layout

\begin_layout Standard
If the probability density of 
\begin_inset Formula $\epsilon$
\end_inset

 in the full population is 
\begin_inset Formula $N(\epsilon,0,\sigma_{\epsilon})$
\end_inset

 (the 
\begin_inset Formula $g$
\end_inset

 case), then it may be proved that the probability density among the detected
 animals is proportional to 
\begin_inset Formula $\gamma(\varepsilon)N(\epsilon,0,\sigma_{\epsilon})\propto N(\epsilon,\sigma_{\epsilon}^{2},\sigma_{\epsilon})$
\end_inset

.
 That is, the density among the detected animals is still Gaussian, but
 has been shifted to the right by an amount 
\begin_inset Formula $\sigma_{\epsilon}^{2}$
\end_inset

.
 This also shifts the distribution of 
\begin_inset Formula $\gamma(\varepsilon)=\exp(\beta+\varepsilon)$
\end_inset

 towards the right, and hence confirms our intuition about the direction
 of the selection bias.
 Under the likelihood 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $L_{f}$
\end_inset

, on the other hand, it is assumed that the density of 
\begin_inset Formula $\epsilon$
\end_inset

 among the detected animals is 
\begin_inset Formula $N(\epsilon,0,\sigma_{\epsilon})$
\end_inset

, i.e.
\backslash
 ignoring 
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
the 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none
right-shift.
 This will affect the estimate of 
\begin_inset Formula $\beta,$
\end_inset

 and as shown in the appendix, the estimate of 
\begin_inset Formula $\beta$
\end_inset

 obtained from 
\begin_inset Formula $L_{f}$
\end_inset

 is
\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
 
\begin_inset Formula 
\begin{equation}
\beta_{f}=\beta_{g}+\sigma_{\epsilon}^{2},\label{eq:beta = beta + sigma}
\end{equation}

\end_inset

where 
\begin_inset Formula $\beta_{g}$
\end_inset

 is obtained from 
\begin_inset Formula $L_{g}$
\end_inset

.
 
\end_layout

\begin_layout Standard
One might be tempted to use the following likelihood:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
L_{f1}(\beta,\sigma_{\epsilon})=\prod_{i=1}^{n}\intop_{-\infty}^{\infty}\frac{g(x_{i}|\epsilon)}{\intop_{0}^{w}g(u|\epsilon)du}N(\epsilon,0,\sigma_{\epsilon})d\epsilon\quad.\label{eq:Incorrect likelihood}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
Compared to eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

, the normal density is omitted from the denominator and the random effect
 is integrated out simultaneously over the numerator and denominator.
 But this is not correct and will produce biased estimates.
 If 
\begin_inset Formula $w=\infty$
\end_inset

, then the relationship 
\begin_inset Formula $\beta_{f1}=\beta_{g}+\sigma_{\epsilon}^{2}$
\end_inset

 holds where 
\begin_inset Formula $\beta_{f1}$
\end_inset

 is derived from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

.
 However, it does not hold if the data are truncated as is generally the
 case for wildlife studies.
\end_layout

\begin_layout Subsection
Mixed scale detection function
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "s:mixed"

\end_inset

 A mixed effects model in which observed covariates (
\begin_inset Formula $\mathbf{z}$
\end_inset

) are included in the detection function can be accomplished by combining
 the covariate model from above (eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:mcds"

\end_inset

) with the random scale model (eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ran gx"

\end_inset

) using:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
\gamma(\epsilon,\mathbf{z})=\exp(\mathbf{X_{\mathbf{z}}}\bm{\beta}+\bm{\epsilon})\quad.\label{eq:lognormal_gamma}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
where 
\begin_inset Formula $\mathbf{X_{\mathbf{z}}}$
\end_inset

 is a design matrix for the observed covariate values, 
\begin_inset Formula $\bm{\beta}$
\end_inset

 is a parameter vector and 
\shape italic

\begin_inset Formula $\bm{\epsilon}$
\end_inset


\shape default
 is the vector of 
\shape italic
n
\shape default
 errors associated with the detections.
 Note that here the intercept 
\shape italic

\begin_inset Formula $\beta$
\end_inset


\shape default
 from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:ran gx"

\end_inset

 is replaced with 
\shape italic

\begin_inset Formula $\bm{X_{\mathbf{z}}\beta}$
\end_inset


\shape default
.
 The half-normal detection function with a mixed scale can now be written
 as:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
g(\bm{x}|\bm{z},\bm{\epsilon})=\exp(-[\bm{x}/\exp(\bm{X_{z}\bm{\beta}}+\bm{\epsilon})]^{2}/2)\label{eq:mixed gx}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
In this case, the likelihood is conditional on the observed covariate values.
 Using the 
\shape italic
g
\shape default
 formulation equivalent to eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

, the likelihood for the sample of 
\shape italic
n
\shape default
 observations is now given by:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
L_{g}(\bm{\beta},\sigma_{\epsilon}|\mathbf{z})=\prod_{i=1}^{n}\frac{\intop_{-\infty}^{\infty}g(x_{i}|\mathbf{z},\epsilon)\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon}{\intop_{-\infty}^{\infty}\int_{0}^{w}g(u|\mathbf{z},\epsilon)du\, N(\epsilon,0,\sigma_{\epsilon})d\epsilon}\label{eq:rangz likelihood}
\end{equation}

\end_inset


\end_layout

\begin_layout Subsection
Density estimators using a random or mixed scale
\end_layout

\begin_layout Standard
Using a random scale detection function, object density 
\shape italic
D
\shape default
 can be obtained using eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:p random"

\end_inset

 in place of 
\shape italic
p
\shape default
 in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:density"

\end_inset

 giving:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\[
D=\frac{n}{2wL\intop_{-\infty}^{\infty}\int_{0}^{w}g(u|\epsilon)du\, N(\epsilon,0,\sigma_{\epsilon})\frac{1}{w}d\epsilon}\quad.
\]

\end_inset


\end_layout

\begin_layout Standard
When explanatory covariates are included for the mixed scale approach, the
 Horvitz-Thompson-like estimator (eq 2.44 in 
\begin_inset CommandInset citation
LatexCommand citealp
key "Borchers2004"

\end_inset

) can be used to estimate object density:
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{equation}
D=\sum_{i=1}^{n}\frac{1}{2wLp_{i}}=\sum_{i=1}^{n}\frac{1}{2wL\intop_{-\infty}^{\infty}\int_{0}^{w}g(u|\epsilon,z_{i})du\, N(\epsilon,0,\sigma_{\epsilon})\frac{1}{w}d\epsilon}\quad,\label{eq:density-1}
\end{equation}

\end_inset


\end_layout

\begin_layout Standard
\noindent
where for each of 
\shape italic

\begin_inset Formula $i=1,2,...,n$
\end_inset


\shape default
 objects, 
\begin_inset Formula $1$
\end_inset

 is divided by the probability that it is detected 
\begin_inset Formula $p_{i}$
\end_inset

, which are then summed up over all 
\shape italic
n
\shape default
.
 For the mixed scale approach, the denonminator of eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:density-1"

\end_inset

 needs to be replaced with 
\begin_inset Formula $s_{i}$
\end_inset

, the size of the 
\begin_inset Formula $i$
\end_inset

th object, in the case that cluster sizes are larger than 1 and density
 of individuals is estimated.
 
\end_layout

\begin_layout Section
Comparing the likelihood functions via simulation
\end_layout

\begin_layout Standard
\begin_inset CommandInset label
LatexCommand label
name "s:modelfitcode"

\end_inset

 R code for fitting models using maximum likelihood with likelihood eqs
 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

, to plot the fitted model and to compute abundance in the covered area
 using eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:density-1"

\end_inset

 multiplied by 2
\shape italic
wL
\shape default
 is provided in the package 
\shape italic
RandomScale
\shape default
 (
\begin_inset Flex URL
status open

\begin_layout Plain Layout

https://github.com/jlaake/RandomScale
\end_layout

\end_inset

).
 The 
\shape italic
RandomScale
\shape default
 package also contains TPL files that were developed to fit the models with
 ADMB 
\begin_inset CommandInset citation
LatexCommand citep
key "Fournier2012"

\end_inset

 using each of the likelihoods (eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

, and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

).
 In addition, C++ code was written to enable the use of multinomial weights
 with Gauss-Hermite integration for the random effects and is contained
 in the package.
 This section serves to illustrate the results obtained with the three different
 likelihood formulations described above.
 All of the code used in this manuscript is explained in detail in Appendices
 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Model-fitting-code"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "sub:Fitting-mixed-scale"

\end_inset

 as well as provided as demo code with the package.
 
\end_layout

\begin_layout Subsection
Fitting random scale detection functions
\end_layout

\begin_layout Standard
We simulate 
\shape italic
n
\shape default
 detections from a half-normal detection function with the default value
 for 
\begin_inset Formula $\beta_{g}$
\end_inset

 = 2 and without any truncation (i.e.
\begin_inset space \space{}
\end_inset


\shape italic
w
\shape default
 = 
\begin_inset Formula $\infty$
\end_inset

).
 We then fit models to these data with the R code from the 
\shape italic
RandomScale
\shape default
 package using likelihood eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

.
 We show plots for each including one with the adjustment of 
\begin_inset Formula $\beta_{f1}=\beta_{g}+\sigma_{\epsilon}^{2}$
\end_inset

 for eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 (when using eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

, the 
\shape italic
intercept parameter
\shape default
 is 
\begin_inset Formula $\beta_{f1}$
\end_inset

).
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph003"

\end_inset

 and Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:hp example_table"

\end_inset

 demonstrate that eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 produces results that are nearly identical to eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 when the data are not truncated and 
\begin_inset Formula $\beta_{f1}$
\end_inset

 is adjusted.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

pdf("RcodeFitting.pdf",width=6,height=4)
\end_layout

\begin_layout Plain Layout

par(mfrow=c(1,3)) 
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

# simulate data
\end_layout

\begin_layout Plain Layout

x=simdata(n=500,w=Inf,beta=2,beta_eps=-.5)
\end_layout

\begin_layout Plain Layout

# fit data with g likelihood; beta_eps is starting value
\end_layout

\begin_layout Plain Layout

results_random=fitdata(x,w=Inf)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=max(x),results_random$model$par,nclass=30,
\end_layout

\begin_layout Plain Layout

        main="eq 6 likelihood",adjust=FALSE)
\end_layout

\begin_layout Plain Layout

# fit data with incorrect likelihood
\end_layout

\begin_layout Plain Layout

results_random_wrong=fitdata(x,w=Inf,wrong=TRUE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=max(x),results_random_wrong$model$par,nclass=30,
\end_layout

\begin_layout Plain Layout

        main="eq 11 likelihood",adjust=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=max(x),results_random_wrong$model$par,nclass=30,
\end_layout

\begin_layout Plain Layout

       main="eq 11 likelihood
\backslash
nadjusted beta")
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

dev.off()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Using the same data, we use calls to ADMB from the 
\shape italic
RandomScale
\shape default
 package to fit models using likelihood eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

, and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 and plot the fitted models with the appropriate adjustments to 
\begin_inset Formula $\beta_{f}$
\end_inset

 and 
\begin_inset Formula $\beta_{f1}$
\end_inset

.
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph004"

\end_inset

 demonstrates that when the data are not truncated the three likelihood
 equations fit similar detection functions.
 For this example of untruncated data, results from the R code and ADMB
 are nearly identical (Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:hp example_table"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

pdf("ADMBcodeFitting.pdf",width=6,height=4)
\end_layout

\begin_layout Plain Layout

par(mfrow=c(1,3)) 
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

glike=fitadmb(x,w=Inf,likelihood="g",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=Inf, glike$coefficients[1:2],nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="eq 6 likelihood",adjust=FALSE)
\end_layout

\begin_layout Plain Layout

f2like=fitadmb(x,w=Inf,likelihood="f2",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=Inf,f2like$coefficients[1:2],nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="eq 9 likelihood
\backslash
nadjusted beta")
\end_layout

\begin_layout Plain Layout

f1like=fitadmb(x,w=Inf,likelihood="f1",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=Inf,f1like$coefficients[1:2],nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="eq 11 likelihood
\backslash
nadjusted beta")
\end_layout

\begin_layout Plain Layout

@
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

dev.off()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Subsection
Fitting mixed scale detection functions
\end_layout

\begin_layout Standard
The following is an example of a mixed effects model that can only be fitted
 at present with the ADMB code and the 
\begin_inset Formula $L_{f}$
\end_inset

 likelihood from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

.
 We simulate 3000 objects from a half-normal detection function truncated
 at 
\shape italic
w
\shape default
 = 50 with a random scale where the first 2000 detected objects were generated
 using a larger scale intercept 
\begin_inset Formula $\beta_{g}$
\end_inset

 compared to the last 1000 objects.
 The subsects of the data are distinguished by including a two-level factor
 covariate with values 0 and 1 for the first and second subset, respectively.
 All objects have the same random effect distribution.
 We fit two models to the data, both using the likelihood 
\begin_inset Formula $L_{f}$
\end_inset

 from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

, however, one model with the covariate (mixed scale) and one without the
 covariate (random scale).
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

pdf("ADMBWithandWithoutCovariate.pdf",width=6,height=4)
\end_layout

\begin_layout Plain Layout

par(mfrow=c(1,2))
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

# simulate data
\end_layout

\begin_layout Plain Layout

x1=simdata(n=2000,w=50,beta_eps=-.5,beta=2,
\end_layout

\begin_layout Plain Layout

          fixed=FALSE,reject=TRUE)
\end_layout

\begin_layout Plain Layout

x2=simdata(n=1000,w=50,beta_eps=-.5,beta=1,
\end_layout

\begin_layout Plain Layout

          fixed=FALSE,reject=TRUE)
\end_layout

\begin_layout Plain Layout

df=data.frame(covariate=c(rep(0,length(x1)),
\end_layout

\begin_layout Plain Layout

          rep(1,length(x2))),distance=c(x1,x2))
\end_layout

\begin_layout Plain Layout

# fit data with covariate
\end_layout

\begin_layout Plain Layout

fwlike=fitadmb(df,w=50,formula=~covariate,
\end_layout

\begin_layout Plain Layout

               likelihood="f2",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

param=fwlike$coefficients[1:3]
\end_layout

\begin_layout Plain Layout

Nhatwcov=plotfit(df$distance,w=50,par=param,nclass=30,
\end_layout

\begin_layout Plain Layout

                 dm=model.matrix(~covariate,df),
\end_layout

\begin_layout Plain Layout

                 main="With covariate")
\end_layout

\begin_layout Plain Layout

Nhatwcov.se=compute_Nhat.se(par=param,fwlike$vcov[1:3,1:3],
\end_layout

\begin_layout Plain Layout

                 x=df,w=50,dm=model.matrix(~covariate,df))
\end_layout

\begin_layout Plain Layout

# fit data without covariate
\end_layout

\begin_layout Plain Layout

flike=fitadmb(df,w=50,formula=~1,
\end_layout

\begin_layout Plain Layout

              likelihood="f2",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

param=flike$coefficients[1:2]
\end_layout

\begin_layout Plain Layout

Nhatwocov=plotfit(df$distance,w=50,par=param,nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="Without covariate")
\end_layout

\begin_layout Plain Layout

Nhatwocov.se=compute_Nhat.se(par=param,flike$vcov[1:2,1:2],
\end_layout

\begin_layout Plain Layout

                 x=df,w=50,dm=model.matrix(~1,df))
\end_layout

\begin_layout Plain Layout

@
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<results=hide,echo=FALSE>>=
\end_layout

\begin_layout Plain Layout

dev.off()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
\noindent
The fit of the detection functions averaged over all data look similar for
 both models (Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph005"

\end_inset

) but the model with the covariate is clearly better with a 
\begin_inset Formula $\triangle$
\end_inset

AIC of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(-2*flike$loglik+2*2-(-2*fwlike$loglik+2*3),2)}
\end_layout

\end_inset

.
 The estimate of abundance from the model with the covariate is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov,0)}
\end_layout

\end_inset

 (se=
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov.se,1)}
\end_layout

\end_inset

) and without the covariate is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov,0)}
\end_layout

\end_inset

 (se=
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov.se,1)}
\end_layout

\end_inset

).
 For the mixed effect model the estimated standard deviation (
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(exp(fwlike$coefficients[3]),2)}
\end_layout

\end_inset

) is smaller than the same quantity for the random effect model (
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(exp(flike$coefficients[2]),2)}
\end_layout

\end_inset

) which absorbs the heterogeneity due to the missing covariate into the
 random effect.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE,results=hide>>=
\end_layout

\begin_layout Plain Layout

pdf("ADMBByCovariate.pdf",width=6,height=4)
\end_layout

\begin_layout Plain Layout

par(mfrow=c(2,2))
\end_layout

\begin_layout Plain Layout

param=fwlike$coefficients[1:3]
\end_layout

\begin_layout Plain Layout

Nhatwcov0=plotfit(df$distance[df$covariate==0],w=50,par=param,
\end_layout

\begin_layout Plain Layout

            nclass=30,dm=model.matrix(~covariate,df[df$covariate==0,]),
\end_layout

\begin_layout Plain Layout

            main="With covariate value=0")
\end_layout

\begin_layout Plain Layout

Nhatwcov0.se=compute_Nhat.se(par=param,fwlike$vcov[1:3,1:3],
\end_layout

\begin_layout Plain Layout

                 x=df[df$covariate==0,],w=50,
\end_layout

\begin_layout Plain Layout

                dm=model.matrix(~covariate,df[df$covariate==0,]))
\end_layout

\begin_layout Plain Layout

Nhatwcov1=plotfit(df$distance[df$covariate==1],w=50,par=param,
\end_layout

\begin_layout Plain Layout

             nclass=30,dm=model.matrix(~covariate,df[df$covariate==1,]),
\end_layout

\begin_layout Plain Layout

             main="With covariate value=1")
\end_layout

\begin_layout Plain Layout

Nhatwcov1.se=compute_Nhat.se(par=param,fwlike$vcov[1:3,1:3],
\end_layout

\begin_layout Plain Layout

                x=df[df$covariate==1,],w=50,
\end_layout

\begin_layout Plain Layout

                dm=model.matrix(~covariate,df[df$covariate==1,]))
\end_layout

\begin_layout Plain Layout

param=flike$coefficients[1:2]
\end_layout

\begin_layout Plain Layout

Nhatwocov0=plotfit(df$distance[df$covariate==0],w=50,par=param,
\end_layout

\begin_layout Plain Layout

             nclass=30, main="Without covariate value=0")
\end_layout

\begin_layout Plain Layout

Nhatwocov0.se=compute_Nhat.se(par=param,flike$vcov[1:2,1:2],
\end_layout

\begin_layout Plain Layout

                 x=df[df$covariate==0,],w=50,
\end_layout

\begin_layout Plain Layout

                dm=model.matrix(~1,df[df$covariate==0,]))
\end_layout

\begin_layout Plain Layout

Nhatwocov1=plotfit(df$distance[df$covariate==1],w=50,par=param,
\end_layout

\begin_layout Plain Layout

             nclass=30,main="Without covariate value=1")
\end_layout

\begin_layout Plain Layout

Nhatwocov1.se=compute_Nhat.se(par=param,flike$vcov[1:2,1:2],
\end_layout

\begin_layout Plain Layout

                 x=df[df$covariate==1,],w=50,
\end_layout

\begin_layout Plain Layout

                dm=model.matrix(~1,df[df$covariate==1,]))
\end_layout

\begin_layout Plain Layout

dev.off()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
The total abundance estimates are similar, but when abundance is estimated
 for each type of object (with covariate: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov0,0)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov0.se,1)}
\end_layout

\end_inset

) and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov1,1)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov1.se,1)}
\end_layout

\end_inset

); without covariate:
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{round(Nhatwocov0,0)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov0.se,1)}
\end_layout

\end_inset

) and 
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{round(Nhatwocov1,1)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov1.se,1)}
\end_layout

\end_inset

) the importance of including the covariate becomes obvious.
 When using the model with the covariate, the model fits tighter to the
 observed data (Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:graph006}
\end_layout

\end_inset

) in particular for the subset of the data with the smaller sample size,
 i.e.
\backslash
 the subsect of the data with covariate value = 1.
 On the other hand, for the model without the covariate predicted detection
 probabilities are too low for distances near zero and too high for larger
 distances which results in an underestimate of abundance of those with
 covariate value 1.
 Likewise, the estimated abundance for objects with covariate value 0 is
 too high.
 
\end_layout

\begin_layout Section
\begin_inset CommandInset label
LatexCommand label
name "sec:Application-to-harbor"

\end_inset

Application to harbor porpoise data
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<echo=FALSE,results=hide>>=
\end_layout

\begin_layout Plain Layout

pdf("hp.pdf",width=6,height=6)
\end_layout

\begin_layout Plain Layout

par(mfrow=c(1,2))
\end_layout

\begin_layout Plain Layout

hp=read.delim("hp.txt",header=TRUE)
\end_layout

\begin_layout Plain Layout

library(mrds)
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

modmcds=ddf(dsmodel=~cds(key="hn",formula=~size),data=hp,method="ds")
\end_layout

\begin_layout Plain Layout

xx=summary(modmcds)
\end_layout

\begin_layout Plain Layout

xx
\end_layout

\begin_layout Plain Layout

modmixed=fitadmb(hp,formula=~size,w=443.1635)
\end_layout

\begin_layout Plain Layout

summary(modmixed)
\end_layout

\begin_layout Plain Layout

Nhat.mcds=xx$Nhat
\end_layout

\begin_layout Plain Layout

Nhat.se.mcds=xx$Nhat.se
\end_layout

\begin_layout Plain Layout

par(mfrow=c(2,1))
\end_layout

\begin_layout Plain Layout

plotfit(hp$distance,w=443.1635,dm=model.matrix(~size,hp[,"size",drop=FALSE]),par=m
odmixed$coeff[1:3])
\end_layout

\begin_layout Plain Layout

plot(modmcds,new=FALSE,showpoints=FALSE,pl.den=0,main="")
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

Nhat.mixed=compute_Nhat(par=modmixed$coeff[1:3],x=hp$distance,w=443.1635,dm=model.m
atrix(~size,hp[,"size",drop=FALSE]))
\end_layout

\begin_layout Plain Layout

Nhat.se.mixed=compute_Nhat.se(par=modmixed$coeff[1:3],vcov=modmixed$vcov[1:3,1:3],x
=hp$distance,w=443.1635,dm=model.matrix(~size,hp[,"size",drop=FALSE]))
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

Nhat.mcds
\end_layout

\begin_layout Plain Layout

Nhat.se.mcds
\end_layout

\begin_layout Plain Layout

Nhat.mixed
\end_layout

\begin_layout Plain Layout

Nhat.se.mixed
\end_layout

\begin_layout Plain Layout

\end_layout

\begin_layout Plain Layout

dev.off()
\end_layout

\begin_layout Plain Layout

@
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
In 2002, a small boat survey for harbor porpoise (
\shape italic
Phocoena phocoena
\shape default
) was conducted in waters of the Strait of Juan de Fuca and around the San
 Juan Islands in Washington state, USA.
 Three observers surveyed along a set of systematically placed lines with
 an observer standing on the bow and at the starboard and port sides.
 When harbor porpoise were detected, the angle from the line to the harbor
 porpoise was measured with an angle board and the radial distance to the
 detection was estimated visually.
 Observers were trained and tested in visual distance estimation but for
 this example, we ignore the error in distance estimation.
 The angle and radial distance was converted to perpendicular distance.
 In addition to distance, the number of harbor porpoise (size) was recorded
 for each detection.
 
\end_layout

\begin_layout Standard
A total of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{nrow(hp)}
\end_layout

\end_inset

 harbor porpoise groups were detected with group size varying from 1 to
 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{max(hp$size)}
\end_layout

\end_inset

.
 We fitted a model with a half-normal detection function and used group
 size as a covariate.
 We fitted a fixed effect detection function with the 
\shape italic
mrds
\shape default
 package (
\begin_inset CommandInset citation
LatexCommand citealt
key "mrds2013"

\end_inset

) and a mixed effects detection function with the RandomScale package.
 The 
\shape italic
mrds
\shape default
 package requires a finite width, so to make the AIC values equivalent we
 set 
\begin_inset Formula $w$
\end_inset

=443.2 the largest distance for each analysis.
 The fit of the detection functions (Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:hp example_table"

\end_inset

) look similar (Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph007"

\end_inset

) but the model that includes the random effect is slightly better with
 a 
\begin_inset Formula $\triangle$
\end_inset

AIC of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{ formatC(xx$aic-(-2*modmixed$loglik+2*modmixed$npar),digits=2)}
\end_layout

\end_inset

.
 The estimate of abundance within the 886.4 meter strip is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{paste(formatC(Nhat.mcds,digits=4)," (se = ",formatC(Nhat.se.mcds,digits=2),")
",sep="")}
\end_layout

\end_inset

 for the fixed effect model and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{paste(formatC(Nhat.mixed,digits=4)," (se = ",formatC(Nhat.se.mixed,digits=2),
")",sep="")}
\end_layout

\end_inset

 for the mixed effect model.
 The higher abundance estimate resulted from the slightly steeper estimated
 detection function (Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph007"

\end_inset

).
 
\end_layout

\begin_layout Section
Summary
\end_layout

\begin_layout Standard
Incorporating a random effect in the scale of the detection function extends
 the covariate approach of 
\begin_inset CommandInset citation
LatexCommand citet
key "Marques2003"

\end_inset

 to enable modeling of additional unspecified and typically unknown sources
 of heterogeneity in detection probability.
 This removes the need to select an arbitrary truncation width which is
 typically needed for the CDS key-adjustment function fitting 
\begin_inset CommandInset citation
LatexCommand citep
key "Buckland2001"

\end_inset

.
 The random and mixed effects modeling can be used with other detection
 functions such as the hazard function 
\begin_inset CommandInset citation
LatexCommand citep
key "Buckland2001"

\end_inset

 as long as the parametrization includes a scale parameter (
\begin_inset Formula $x/\sigma)$
\end_inset

; although it could also be applied to the shape parameter in the hazard
 function.
 The models can be easily extended to allow covariates to be included for
 the random effects standard deviation 
\family roman
\series medium
\shape up
\size normal
\emph off
\bar no
\strikeout off
\uuline off
\uwave off
\noun off
\color none

\begin_inset Formula $\sigma_{\epsilon}$
\end_inset


\family default
\series default
\shape default
\size default
\emph default
\bar default
\strikeout default
\uuline default
\uwave default
\noun default
\color inherit
.
 For example, heterogeneity in detection probability may be enhanced or
 reduced as a function of weather, habitat or other covariates.
 We propose that a random or mixed effect model of the detection function
 scale be adopted as a standard approach for fitting detection functions
 in distance sampling.
 
\end_layout

\begin_layout Section*
Acknowledgements
\end_layout

\begin_layout Standard
We thank Steve Buckland for reviewing a nearly final draft of the paper.
 The first author was supported by a studentship jointly funded by the Universit
y of St Andrews and EP-SRC, through the National Centre for Statistical
 Ecology (EPSRC grant EP/C522702/1).
\end_layout

\begin_layout Standard
\begin_inset CommandInset bibtex
LatexCommand bibtex
bibfiles "biblio"
options "biom"

\end_inset


\end_layout

\begin_layout Section
Appendix
\end_layout

\begin_layout Subsection
Connection between the f and g formulations
\end_layout

\begin_layout Standard
\noindent
The result referred to above in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:beta = beta + sigma"

\end_inset

 section 
\begin_inset CommandInset ref
LatexCommand ref
reference "s:likelihoods"

\end_inset

 applies to the situation where the detection function is of the form 
\begin_inset Formula $g(x|\gamma)=k(x/\gamma)$
\end_inset

, where 
\begin_inset Formula $k()$
\end_inset

 is some base detection function and 
\begin_inset Formula $\gamma>0$
\end_inset

 is a scale parameter.
 Under this model the perpendicular density for line transects is 
\begin_inset Formula $f(x|\gamma)=\left\{ \int_{0}^{\infty}g(x|\gamma)dx\right\} ^{-1}g(x|\gamma)=\gamma^{-1}\left\{ \int_{0}^{\infty}k(u)du\right\} ^{-1}k(x/\gamma)$
\end_inset

.
 The second requirement for the result to hold is that the scale parameter
 
\begin_inset Formula $\gamma$
\end_inset

 has a log-normal distribution given by eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lognormal_gamma"

\end_inset

.
 For simplicity we ignore the regression part in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:lognormal_gamma"

\end_inset

 such that 
\begin_inset Formula $\gamma(\epsilon)=\exp(\epsilon)$
\end_inset

, where 
\begin_inset Formula $\epsilon\sim N(\beta,\sigma_{\epsilon})$
\end_inset

.
\end_layout

\begin_layout Standard
Consider two sampling mechanisms: 
\end_layout

\begin_layout Enumerate
Each individual in the population (whether detected or not) has detection
 function 
\begin_inset Formula $g\left\{ x|\gamma(\epsilon)\right\} $
\end_inset

, where 
\begin_inset Formula $\epsilon\sim N(\beta,\sigma_{\epsilon})$
\end_inset

.
 This gives rise to the likelihood in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

.
 
\end_layout

\begin_layout Enumerate
Each individual 
\shape italic
among the detected individuals
\shape default
 has perpendicular density 
\begin_inset Formula $f\left\{ x|\gamma(\epsilon)\right\} $
\end_inset

, where 
\begin_inset Formula $\epsilon\sim N(\beta,\sigma_{\epsilon})$
\end_inset

.
 This gives rise to the likelihood in eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

.
 
\end_layout

\begin_layout Standard
The difference between the two is the subgroup to which the assumption about
 lognormality is applied.
 The following result shows that likelihoods are linked parametrically.
\end_layout

\begin_layout Paragraph
Theorem
\end_layout

\begin_layout Standard
Let 
\begin_inset Formula $p_{g}(x;\beta,\sigma_{\epsilon})$
\end_inset

 and 
\begin_inset Formula $p_{f}(x;\beta,\sigma_{\epsilon})$
\end_inset

 refer to the density of perpendicular densities truncated to the interval
 
\begin_inset Formula $[0,w]$
\end_inset

 under sampling mechanisms 1) and 2) above, respectively.
 We then have 
\begin_inset Formula $p_{f}(x;\beta,\sigma_{\epsilon})=p_{g}(x;\beta-\sigma_{\epsilon}^{2},\sigma_{\epsilon})$
\end_inset

, and 
\begin_inset Formula $\beta_{f}=\beta_{g}+\sigma_{\epsilon}^{2}$
\end_inset

.
\end_layout

\begin_layout Paragraph
Proof
\end_layout

\begin_layout Standard
We put 
\begin_inset Formula $\gamma(\epsilon)=\exp(\epsilon)$
\end_inset

, and get
\end_layout

\begin_layout Standard
\begin_inset Formula 
\begin{eqnarray*}
p_{g}(x;\beta-\sigma_{\epsilon}^{2},\sigma_{\epsilon}^{2}) & = & \frac{\int g(x|\gamma(\epsilon))\, N(\epsilon,\beta-\sigma_{\epsilon}^{2},\sigma_{\epsilon})d\epsilon}{\int\int_{0}^{w}g(u|\gamma(\epsilon))du\, N(\epsilon,\beta-\sigma_{\epsilon}^{2},\sigma_{\epsilon})d\epsilon}\\
 & = & \frac{\int\gamma(\epsilon)^{-1}g(x|\gamma(\epsilon))\,\exp(\epsilon)N(\epsilon,\beta-\sigma_{\epsilon}^{2},\sigma_{\epsilon})d\epsilon}{\int\int_{0}^{w}\gamma(\epsilon)^{-1}g(u|\gamma(\epsilon))du\,\exp(\epsilon)N(\epsilon,\beta-\sigma_{\epsilon}^{2},\sigma_{\epsilon})d\epsilon}\\
 & = & \frac{\int\gamma(\epsilon)^{-1}g(x|\gamma(\epsilon))\, N(\epsilon,\beta,\sigma_{\epsilon})d\epsilon\,\exp(\beta-\frac{1}{2}\sigma_{\epsilon}^{2})}{\int\int_{0}^{w}\gamma(\epsilon)^{-1}g(u|\gamma(\epsilon))du\, N(\epsilon,\beta,\sigma_{\epsilon})d\epsilon\,\exp(\beta-\frac{1}{2}\sigma_{\epsilon}^{2})}\\
 & = & p_{f}(x,\beta,\sigma_{\epsilon})
\end{eqnarray*}

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "sub:Model-fitting-code"

\end_inset

Model fitting code for random effects models
\end_layout

\begin_layout Standard
The following code simulates 
\shape italic
n
\shape default
 detections from a half-normal detection function with the default value
 for 
\begin_inset Formula $\beta_{g}$
\end_inset

 = 2 and without any truncation (i.e.
\begin_inset space \space{}
\end_inset


\shape italic
w
\shape default
 = 
\begin_inset Formula $\infty$
\end_inset

).
 Note that the value for 
\begin_inset Formula $\sigma_{\epsilon}$
\end_inset

 enters the function on the log-scale using the argument 
\shape italic

\begin_inset Formula $beta\_eps$
\end_inset


\shape default
 to avoid numerical issues.
 We then fit models with the R code from the 
\shape italic
RandomScale
\shape default
 package (
\begin_inset Flex URL
status open

\begin_layout Plain Layout

https://github.com/jlaake/RandomScale
\end_layout

\end_inset

) using likelihood eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

.
 Using the R code, these likelihood functions are fitted with the 
\shape italic
fitdata
\shape default
 function where the argument 
\shape italic
wrong
\shape default
 allows distinguishing between likelihood 
\begin_inset Formula $L_{g}$
\end_inset

 from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 (using the default 
\shape italic
wrong = FALSE
\shape default
) and likelihood 
\begin_inset Formula $L_{fi}$
\end_inset

 from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 (
\shape italic
wrong = TRUE
\shape default
).
 We show plots for each including one with the adjustment of 
\begin_inset Formula $\beta_{f1}=\beta_{g}+\sigma_{\epsilon}^{2}$
\end_inset

 for eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 (if 
\shape italic
wrong = TRUE
\shape default
, the first parameter value returned from 
\shape italic
fitdata
\shape default
 is 
\begin_inset Formula $\beta_{f1}$
\end_inset

).
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph003"

\end_inset

 and Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:hp example_table"

\end_inset

 demonstrate that eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 produces results that are nearly identical to eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 when the data are not truncated and 
\begin_inset Formula $\beta_{f1}$
\end_inset

 is adjusted.
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<eval=FALSE>>=
\end_layout

\begin_layout Plain Layout

# simulate data
\end_layout

\begin_layout Plain Layout

x=simdata(n=500,w=Inf,beta=2,beta_eps=-.5)
\end_layout

\begin_layout Plain Layout

# fit data with g likelihood; beta_eps is starting value
\end_layout

\begin_layout Plain Layout

results_random=fitdata(x,w=Inf)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=max(x),results_random$model$par,nclass=30,
\end_layout

\begin_layout Plain Layout

        main="eq 6 likelihood",adjust=FALSE)
\end_layout

\begin_layout Plain Layout

# fit data with incorrect likelihood
\end_layout

\begin_layout Plain Layout

results_random_wrong=fitdata(x,w=Inf,wrong=TRUE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=max(x),results_random_wrong$model$par,nclass=30,
\end_layout

\begin_layout Plain Layout

        main="eq 11 likelihood",adjust=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=max(x),results_random_wrong$model$par,nclass=30,
\end_layout

\begin_layout Plain Layout

       main="eq 11 likelihood
\backslash
nadjusted beta")
\end_layout

\begin_layout Plain Layout

@
\end_layout

\end_inset


\end_layout

\begin_layout Standard
Using the same data, we use calls to ADMB from R using the 
\shape italic
RandomScale
\shape default
 package to fit models using likelihood eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

, and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 and plot the fitted models with the appropriate adjustments to 
\begin_inset Formula $\beta_{f}$
\end_inset

 and 
\begin_inset Formula $\beta_{f1}$
\end_inset

.
 Note that for the function 
\shape italic
fitadmb
\shape default
 the argument 
\shape italic
likelihood
\shape default
 determines which likelihood is used for the optimization where "g", "f2"
 and "f1" refer to eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

, and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

, respectively.
 Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph004"

\end_inset

 demonstrates that when the data are not truncated the three likelihood
 equations fit similar detection functions.
 For this example of untruncated data, results from the R code and ADMB
 are nearly identical (Table 
\begin_inset CommandInset ref
LatexCommand ref
reference "tab:hp example_table"

\end_inset

).
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<eval=FALSE>>=
\end_layout

\begin_layout Plain Layout

glike=fitadmb(x,w=Inf,likelihood="g",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=Inf, glike$coefficients[1:2],nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="eq 6 likelihood",adjust=FALSE)
\end_layout

\begin_layout Plain Layout

f2like=fitadmb(x,w=Inf,likelihood="f2",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=Inf,f2like$coefficients[1:2],nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="eq 9 likelihood
\backslash
nadjusted beta")
\end_layout

\begin_layout Plain Layout

f1like=fitadmb(x,w=Inf,likelihood="f1",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

plotfit(x,w=Inf,f1like$coefficients[1:2],nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="eq 11 likelihood
\backslash
nadjusted beta")
\end_layout

\begin_layout Plain Layout

@
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Subsection
\begin_inset CommandInset label
LatexCommand label
name "sub:Fitting-mixed-scale"

\end_inset

Fitting mixed scale detection functions
\end_layout

\begin_layout Standard
The following is an example of a mixed effects model that can only be fitted
 at present with the ADMB code and the 
\begin_inset Formula $L_{f}$
\end_inset

 likelihood from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

.
 We simulate 3000 objects from a half-normal detection function truncated
 at 
\shape italic
w
\shape default
 = 50 with a random scale where the first 2000 detected objects were generated
 using a larger scale intercept 
\begin_inset Formula $\beta_{g}$
\end_inset

 compared to the last 1000 objects.
 All objects have the same random effect distribution.
 We fit two models to the data, both using the likelihood 
\begin_inset Formula $L_{f}$
\end_inset

 from eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

, however, one model with the covariate (mixed scale, 
\shape italic
fwlike
\shape default
) and one without the covariate (random scale, 
\shape italic
flike
\shape default
).
 Note that the argument 
\shape italic
formula
\shape default
 is used to specify the covariate model for the detection function.
 
\end_layout

\begin_layout Standard
\begin_inset ERT
status open

\begin_layout Plain Layout

<<eval=FALSE>>=
\end_layout

\begin_layout Plain Layout

# simulate data
\end_layout

\begin_layout Plain Layout

x1=simdata(n=2000,w=50,beta_eps=-.5,beta=2,
\end_layout

\begin_layout Plain Layout

          fixed=FALSE,reject=TRUE)
\end_layout

\begin_layout Plain Layout

x2=simdata(n=1000,w=50,beta_eps=-.5,beta=1,
\end_layout

\begin_layout Plain Layout

          fixed=FALSE,reject=TRUE)
\end_layout

\begin_layout Plain Layout

df=data.frame(covariate=c(rep(0,length(x1)),
\end_layout

\begin_layout Plain Layout

          rep(1,length(x2))),distance=c(x1,x2))
\end_layout

\begin_layout Plain Layout

# fit data with covariate
\end_layout

\begin_layout Plain Layout

fwlike=fitadmb(df,w=50,formula=~covariate,
\end_layout

\begin_layout Plain Layout

               likelihood="f2",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

param=fwlike$coefficients[1:3]
\end_layout

\begin_layout Plain Layout

Nhatwcov=plotfit(df$distance,w=50,par=param,nclass=30,
\end_layout

\begin_layout Plain Layout

                 dm=model.matrix(~covariate,df),
\end_layout

\begin_layout Plain Layout

                 main="With covariate")
\end_layout

\begin_layout Plain Layout

Nhatwcov.se=compute_Nhat.se(par=param,fwlike$vcov[1:3,1:3],
\end_layout

\begin_layout Plain Layout

                 x=df,w=50,dm=model.matrix(~covariate,df))
\end_layout

\begin_layout Plain Layout

# fit data without covariate
\end_layout

\begin_layout Plain Layout

flike=fitadmb(df,w=50,formula=~1,
\end_layout

\begin_layout Plain Layout

              likelihood="f2",verbose=FALSE)
\end_layout

\begin_layout Plain Layout

param=flike$coefficients[1:2]
\end_layout

\begin_layout Plain Layout

Nhatwocov=plotfit(df$distance,w=50,par=param,nclass=30,
\end_layout

\begin_layout Plain Layout

                 main="Without covariate")
\end_layout

\begin_layout Plain Layout

Nhatwocov.se=compute_Nhat.se(par=param,flike$vcov[1:2,1:2],
\end_layout

\begin_layout Plain Layout

                 x=df,w=50,dm=model.matrix(~1,df))
\end_layout

\begin_layout Plain Layout

@
\end_layout

\begin_layout Plain Layout

\end_layout

\end_inset


\end_layout

\begin_layout Standard
\noindent
The fit of the detection functions averaged over all data look similar for
 both models (Figure 
\begin_inset CommandInset ref
LatexCommand ref
reference "fig:graph005"

\end_inset

) but the model with the covariate is clearly better with a 
\begin_inset Formula $\triangle$
\end_inset

AIC of 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(-2*flike$loglik+2*2-(-2*fwlike$loglik+2*3),2)}
\end_layout

\end_inset

.
 The estimate of abundance from the model with the covariate is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov,0)}
\end_layout

\end_inset

 (se=
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov.se,1)}
\end_layout

\end_inset

) and without the covariate is 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov,0)}
\end_layout

\end_inset

 (se=
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov.se,1)}
\end_layout

\end_inset

).
 For the mixed effect model the estimated standard deviation (
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(exp(fwlike$coefficients[3]),2)}
\end_layout

\end_inset

) is smaller than the same quantity for the random effect model (
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(exp(flike$coefficients[2]),2)}
\end_layout

\end_inset

) which absorbs the heterogeneity due to the missing covariate into the
 random effect.
\end_layout

\begin_layout Standard
The total abundance estimates are similar, but when abundance is estimated
 for each type of object (with covariate: 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov0,0)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov0.se,1)}
\end_layout

\end_inset

) and 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov1,1)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwcov1.se,1)}
\end_layout

\end_inset

); without covariate:
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{round(Nhatwocov0,0)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov0.se,1)}
\end_layout

\end_inset

) and 
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{round(Nhatwocov1,1)}
\end_layout

\end_inset

 (se = 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{round(Nhatwocov1.se,1)}
\end_layout

\end_inset

) the importance of including the covariate becomes obvious.
 When using the model with the covariate, the model fits tighter to the
 observed data (Figure 
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
ref{fig:graph006}
\end_layout

\end_inset

) in particular for the subset of the data with the smaller sample size,
 i.e.
\backslash
 
\emph on
x2
\emph default
 with covariate value = 1.
 On the other hand, for the model without the covariate predicted detection
 probabilities are too low for distances near zero and too high for larger
 distances which results in an underestimate of abundance of those with
 covariate value 1.
 Likewise, the abundance for objects with covariate value 0 is too high.
 
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[width=6in,height=4in]
\end_layout

\begin_layout Plain Layout

{RCodeFitting.pdf}
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:graph003"

\end_inset

Random scale detection functions fitted to simulated data with R code using
 the likelihood eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[width=6in,height=4in]
\end_layout

\begin_layout Plain Layout

{ADMBCodeFitting.pdf}
\end_layout

\end_inset

 
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:graph004"

\end_inset

 Random scale detection functions fitted to simulated data with ADMB code
 using the likelihood eqs 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

, 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

 and 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

.
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[width=6in,height=4in]
\end_layout

\begin_layout Plain Layout

{ADMBWithandWithoutCovariate.pdf}
\end_layout

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:graph005"

\end_inset

 Average detection functions fitted to simulated data with ADMB code using
 the likelihood eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

 with and without the covariate.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[width=6in,height=4in]
\end_layout

\begin_layout Plain Layout

{ADMBByCovariate.pdf}
\end_layout

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:graph006"

\end_inset

 Detection functions fitted to simulated data with ADMB code using the likelihoo
d eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

 with (top row of plots) and without the covariate (bottom row of plots)
 shown for subsets x1 and x2 of the simulated data.
 
\end_layout

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float figure
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
includegraphics[width=6in,height=4in]
\end_layout

\begin_layout Plain Layout

{hp.pdf}
\end_layout

\end_inset


\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "fig:graph007"

\end_inset

 Detection functions fitted to harbor porpoise vessel survey data.
 The upper panel is the mixed effects model and lower panel is the fixed
 effects model.
 Both include group size as a covariate.
 
\end_layout

\end_inset


\end_layout

\end_inset


\begin_inset Newpage clearpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:Comparison_table"

\end_inset

Comparison of random scale model fitting results from R and ADMB using simulated
 data.
 True values for 
\begin_inset Formula $\beta_{g}$
\end_inset

 and 
\begin_inset Formula $log(\sigma_{\epsilon})$
\end_inset

 were 2 and -0.5.
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="6" columns="6">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Code 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Likelihood eq 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Log-likelihood 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\beta_{f}$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset Formula $\beta_{g}$
\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
log(
\begin_inset Formula $\sigma_{\epsilon}$
\end_inset

)
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
R 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%7.2f",-results_random$model$val)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{ sprintf("%5.3f",results_random$model$par[1])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",results_random$model$par[2])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
R 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%7.2f",-results_random_wrong$model$val)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",results_random_wrong$model$par[1])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",results_random_wrong$model$par[1]-exp(results_random_wrong$
model$par[2]*2))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",results_random_wrong$model$par[2])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ADMB 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:g likelihood"

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%7.2f",glike$loglik)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
NA 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",glike$coeflist[[1]])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",glike$coeflist[[2]])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ADMB 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:f likelihood"

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%7.2f",f2like$loglik)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",f2like$coeflist[[1]])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",f2like$coeflist[[1]]-exp(2*f2like$coeflist[[2]]))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",f2like$coeflist[[2]])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
ADMB 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
eq 
\begin_inset CommandInset ref
LatexCommand ref
reference "eq:Incorrect likelihood"

\end_inset

 
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%7.2f",f1like$loglik)}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f",f1like$coeflist[[1]])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f",f1like$coeflist[[1]]-exp(2*f2like$coeflist[[2]]))}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.3f",f1like$coeflist[[2]])}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\begin_layout Standard
\begin_inset Newpage newpage
\end_inset


\end_layout

\begin_layout Standard
\begin_inset Float table
placement h
wide false
sideways false
status open

\begin_layout Plain Layout
\begin_inset Caption

\begin_layout Plain Layout
\begin_inset CommandInset label
LatexCommand label
name "tab:hp example_table"

\end_inset

Parameter estimates, standard errors for fixed (AIC=
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.1f",xx$aic)}
\end_layout

\end_inset

) and mixed effect (AIC=
\begin_inset ERT
status open

\begin_layout Plain Layout


\backslash
Sexpr{sprintf("%5.1f",-2*modmixed$loglik+2*modmixed$npar)}
\end_layout

\end_inset

) models fitted to harbor porpoise vessel survey data.
 
\end_layout

\end_inset


\end_layout

\begin_layout Plain Layout
\begin_inset Tabular
<lyxtabular version="3" rows="5" columns="5">
<features tabularvalignment="middle">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<column alignment="center" valignment="top" width="0">
<row>
<cell alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Fixed-effect
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell multicolumn="1" alignment="center" valignment="top" topline="true" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Mixed-effect
\end_layout

\end_inset
</cell>
<cell multicolumn="2" alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Estimate
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Std error
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Estimate
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Std error
\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Intercept
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", xx$coeff$key.scale$estimate[1] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", xx$coeff$key.scale$se[1] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", coef(modmixed)[1] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", summary(modmixed)$coefficients[1,2] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
Size
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", xx$coeff$key.scale$estimate[2] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", xx$coeff$key.scale$se[2] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", coef(modmixed)[2] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", summary(modmixed)$coefficients[2,2] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
<row>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
log(
\begin_inset Formula $\sigma_{\epsilon}$
\end_inset

)
\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout

\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", coef(modmixed)[3] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
<cell alignment="center" valignment="top" bottomline="true" usebox="none">
\begin_inset Text

\begin_layout Plain Layout
\begin_inset ERT
status open

\begin_layout Plain Layout

 
\backslash
Sexpr{sprintf("%5.3f", summary(modmixed)$coefficients[3,2] )}
\end_layout

\end_inset


\end_layout

\end_inset
</cell>
</row>
</lyxtabular>

\end_inset


\end_layout

\end_inset


\end_layout

\end_body
\end_document
